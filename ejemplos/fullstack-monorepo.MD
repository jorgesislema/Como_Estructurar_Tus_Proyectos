
# Ejemplo: Monorepo Fullstack Moderno (Turborepo, PNPM, React, Node.js)

Â¡Bienvenido/a a la plantilla de ejemplo de un monorepo fullstack! Este repositorio demuestra cÃ³mo estructurar y gestionar un proyecto que contiene mÃºltiples aplicaciones (como un frontend web y una API backend) y librerÃ­as compartidas, todo dentro de un Ãºnico repositorio Git.

## Â¿QuÃ© es un Monorepo y Por QuÃ© Usarlo? ğŸ¤”

Un **monorepo** es una estrategia de control de versiones donde el cÃ³digo de muchos proyectos relacionados vive en el mismo repositorio. Contrasta con el enfoque *polyrepo* (un repositorio por proyecto).

**Ventajas:**

* **CÃ³digo Compartido Simplificado:** FÃ¡cil de crear y consumir librerÃ­as/tipos compartidos (`packages/shared-types`) entre el frontend y el backend.
* **Cambios AtÃ³micos:** Un solo commit/PR puede abarcar cambios coordinados en el frontend, backend y librerÃ­as compartidas.
* **RefactorizaciÃ³n mÃ¡s Sencilla:** Mover cÃ³digo entre paquetes o renombrar interfaces compartidas es mÃ¡s directo.
* **Consistencia de Tooling:** MÃ¡s fÃ¡cil aplicar linters, formateadores y configuraciones de TypeScript de forma uniforme en todo el proyecto.
* **GestiÃ³n de Dependencias Centralizada (Parcial):** Aunque cada paquete tiene sus dependencias, herramientas como PNPM optimizan el almacenamiento y enlazado.

**DesafÃ­os (Â¡Abordados aquÃ­!):**

* **Tooling Complejo:** Se necesitan herramientas especÃ­ficas para gestionar dependencias y ejecutar tareas eficientemente. (Usamos **PNPM Workspaces** y **Turborepo**).
* **Tiempos de Build/Test Largos:** Sin optimizaciÃ³n, construir/testear todo en cada cambio es lento. (**Turborepo** soluciona esto con cacheo inteligente).
* **Control de Acceso:** Puede ser mÃ¡s complejo si diferentes equipos necesitan permisos distintos (mÃ¡s relevante a gran escala).

Este ejemplo utiliza **PNPM Workspaces** para manejar las dependencias entre paquetes locales de forma eficiente y **Turborepo** para orquestar tareas (build, test, lint) y aplicar un cacheo muy efectivo, acelerando significativamente los flujos de trabajo.

## Objetivo ğŸ¯

* Mostrar una **estructura de monorepo funcional y escalable** usando herramientas modernas.
* Demostrar cÃ³mo gestionar **mÃºltiples paquetes** (frontend, backend, compartido) en un solo lugar.
* Ilustrar el uso de **Turborepo** para optimizar la ejecuciÃ³n de tareas y el cacheo.
* Servir como un **punto de partida prÃ¡ctico** para tus propios proyectos fullstack en monorepo.

## TecnologÃ­as Clave ğŸ› ï¸

* **Gestor de Monorepo:** [Turborepo](https://turbo.build/repo)
* **Gestor de Paquetes / Workspaces:** [PNPM](https://pnpm.io/)
* **Frontend (`packages/web`):** [React](https://react.dev/), [Vite](https://vitejs.dev/), [TypeScript](https://www.typescriptlang.org/)
* **Backend (`packages/api`):** [Node.js](https://nodejs.org/), [Express](https://expressjs.com/) (o Fastify), [TypeScript](https://www.typescriptlang.org/)
* **Paquete Compartido (`packages/shared-types`):** [TypeScript](https://www.typescriptlang.org/)
* **Calidad de CÃ³digo:** ESLint, Prettier (configurados en la raÃ­z y/o por paquete).

## Estructura del Directorio ğŸ—ºï¸

* **RaÃ­z:** Contiene la configuraciÃ³n global del monorepo y herramientas.
    * `package.json`: Define los `workspaces` (usando PNPM), los scripts globales que usan Turbo (ej: `pnpm dev`), y las dependencias de desarrollo raÃ­z (Turborepo, TypeScript, linters). **Importante:** `private: true` para evitar publicar la raÃ­z en npm.
    * `pnpm-workspace.yaml`: Especifica dÃ³nde buscar los paquetes dentro del monorepo (usualmente `packages/*`).
    * `turbo.json`: Â¡El cerebro de Turborepo! Define los `pipelines` (cÃ³mo ejecutar tareas como `build`, `dev`, `lint`, `test`), sus dependencias (ej: `build` depende de los `build` de sus dependencias internas y de `^build` que significa las dependencias del paquete), y quÃ© artefactos/logs cachear.
    * `tsconfig.base.json`: ConfiguraciÃ³n base de TypeScript que los paquetes pueden extender.
* **`packages/`**: Directorio que contiene cada aplicaciÃ³n o librerÃ­a individual. Cada subdirectorio es un "paquete" autocontenido con su propio `package.json`, cÃ³digo fuente y configuraciÃ³n especÃ­fica.
    * **`api/`**: AplicaciÃ³n backend Node.js/Express. Tiene sus propias dependencias y scripts. Puede depender de `shared-types`.
    * **`web/`**: AplicaciÃ³n frontend React/Vite. Tiene sus propias dependencias y scripts. Puede depender de `shared-types` y consumir la `api`.
    * **`shared-types/`**: Ejemplo de librerÃ­a compartida. En este caso, solo contiene definiciones de tipos TypeScript. Otros paquetes (`api`, `web`) pueden declararla como dependencia en sus `package.json`.

## CÃ³mo Usar esta Plantilla ğŸš€

1.  **Prerrequisitos:**
    * Node.js (verifica la versiÃ³n recomendada si hay un archivo `.node-version` o `.nvmrc`).
    * PNPM instalado globalmente: `npm install -g pnpm`
2.  **Clonar:** `git clone <URL_DEL_REPO_UNIVERSAL> && cd ejemplos/fullstack-monorepo`
3.  **Instalar Dependencias:** Este comando instalarÃ¡ las dependencias para **todos** los paquetes definidos en los workspaces y los enlazarÃ¡ localmente.
    ```bash
    pnpm install
    ```
4.  **Variables de Entorno:** Configura los archivos `.env` necesarios dentro de cada paquete que lo requiera (ej: `packages/api/.env`, `packages/web/.env`) basÃ¡ndote en sus respectivos `.env.example`.
5.  **Ejecutar Servidores de Desarrollo:** Turborepo orquestarÃ¡ el inicio de los servidores de `api` y `web` (y cualquier otro paquete con script `dev`).
    ```bash
    # Ejecuta el script 'dev' definido en el package.json raÃ­z,
    # que a su vez usa 'turbo run dev'
    pnpm dev
    ```
    Turborepo ejecutarÃ¡ los scripts `dev` definidos en los `package.json` de `api` y `web` en paralelo.
6.  **Construir Todos los Paquetes:** Turborepo construirÃ¡ los paquetes en el orden correcto (respetando dependencias) y usarÃ¡ el cache si es posible.
    ```bash
    pnpm build
    ```
7.  **Ejecutar Linters/Tests:**
    ```bash
    pnpm lint
    pnpm test
    ```
    Turborepo ejecutarÃ¡ los scripts correspondientes en todos los paquetes que los definan.
8.  **Ejecutar Comandos en un Paquete EspecÃ­fico:** Usa el flag `--filter` de PNPM (o Turbo).
    ```bash
    # Ejecutar solo el dev server de la API
    pnpm --filter api dev

    # Ejecutar solo los tests del frontend
    pnpm --filter web test

    # Construir solo la librerÃ­a compartida y los paquetes que dependen de ella
    pnpm --filter shared-types... build
    ```

## Conceptos Clave del Monorepo AquÃ­ Implementado ğŸ§©

* **Workspaces (PNPM):** PNPM lee `pnpm-workspace.yaml` y el campo `workspaces` en `package.json` para saber dÃ³nde estÃ¡n los paquetes. `pnpm install` instala todo y crea symlinks en `node_modules` para que los paquetes puedan importarse entre sÃ­ como dependencias normales (ej: `import { User } from 'shared-types';`).
* **Task Orchestration (Turborepo):** Turborepo lee `turbo.json` para entender las dependencias entre tareas (ej: el `build` de `web` depende del `build` de `shared-types`). Ejecuta tareas en paralelo cuando es posible y en el orden correcto.
* **Caching (Turborepo):** Turborepo cachea la salida (`dist/`, `.turbo/`) y los logs de las tareas. Si ejecutas `pnpm build` una segunda vez sin cambios en el cÃ³digo fuente de un paquete y sus dependencias, Turborepo restaurarÃ¡ la salida desde el cache instantÃ¡neamente (verÃ¡s `FULL TURBO`). Â¡Esto ahorra muchÃ­simo tiempo!
* **Shared Packages:** El paquete `shared-types` es un ejemplo. Se construye (compila TS a JS + `.d.ts`) y otros paquetes (`api`, `web`) lo declaran como dependencia en su `package.json` (usando `pnpm add shared-types --filter web`). PNPM se encarga del enlace local.

## Siguientes Pasos y AdaptaciÃ³n ğŸ‘£

* **AÃ±ade una Base de Datos:** Integra una base de datos en el backend (`api/`) y usa Docker Compose para gestionarla localmente.
* **Implementa AutenticaciÃ³n Completa:** AÃ±ade lÃ³gica de autenticaciÃ³n en `api` y `web`.
* **Crea mÃ¡s Paquetes:**
    * Una librerÃ­a de componentes UI compartida (`packages/ui-library`).
    * Una aplicaciÃ³n mÃ³vil (React Native, Flutter).
    * Herramientas de scripting (`packages/scripts`).
* **Refina el Pipeline de Turborepo:** Ajusta `turbo.json` para optimizar dependencias entre tareas y estrategias de cacheo.
* **Despliegue:** Configura despliegues independientes para `api` y `web` usando la CI/CD, aprovechando el cache de Turborepo (Remote Caching). Plataformas como Vercel y Netlify tienen integraciÃ³n nativa con Turborepo.

## Contribuciones a este Ejemplo âœ¨

Las sugerencias para mejorar *esta plantilla especÃ­fica de monorepo* son bienvenidas. Sigue la guÃ­a general (`comunidad/como-contribuir.md`) indicando que tu aporte es para `ejemplos/fullstack-monorepo`.

Â¡Esperamos que esta plantilla te dÃ© un impulso inicial fantÃ¡stico para tus proyectos fullstack en monorepo! Â¡Disfruta de la potencia y la organizaciÃ³n! ğŸš€
``` bash

Okay, Â¡un ejemplo de monorepo fullstack! Este es un patrÃ³n cada vez mÃ¡s popular, especialmente en el ecosistema de TypeScript/JavaScript, para gestionar proyectos complejos con mÃºltiples aplicaciones (frontend, backend, etc.) y librerÃ­as compartidas dentro de un Ãºnico repositorio.

Para este ejemplo, utilizaremos un enfoque moderno con PNPM Workspaces para la gestiÃ³n eficiente de dependencias y Turborepo para la orquestaciÃ³n de tareas y el cacheo inteligente de builds/tests. La pila tecnolÃ³gica serÃ¡ React (con Vite y TypeScript) para el frontend y Node.js (con Express y TypeScript) para el backend, ademÃ¡s de un paquete compartido.

Asumiendo que este ejemplo pertenece a ejemplos/, procederÃ© a generar la estructura y el README para:

ejemplos/fullstack-monorepo/

AvÃ­same si prefieres otra ubicaciÃ³n.
Estructura Propuesta para ejemplos/fullstack-monorepo/

ejemplos/fullstack-monorepo/
â”œâ”€â”€ .gitattributes              # (Opcional) Para normalizar finales de lÃ­nea
â”œâ”€â”€ .gitignore                  # Ignorar node_modules, dist, .turbo, .env, etc.
â”œâ”€â”€ .prettierignore             # (Opcional) Ignorar archivos para Prettier
â”œâ”€â”€ .prettierrc.json            # (Opcional) ConfiguraciÃ³n de Prettier en la raÃ­z
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md                   # Este archivo: explicaciÃ³n del monorepo
â”œâ”€â”€ package.json                # RaÃ­z: Define workspaces, scripts globales, devDeps (turbo, typescript, etc.)
â”œâ”€â”€ pnpm-workspace.yaml         # Define la ubicaciÃ³n de los paquetes/workspaces
â”œâ”€â”€ tsconfig.base.json          # ConfiguraciÃ³n base de TypeScript compartida
â””â”€â”€ turbo.json                  # ConfiguraciÃ³n de Turborepo (pipelines, cacheo)
â””â”€â”€ packages/                   # Directorio que contiene todos los paquetes/apps
    â”œâ”€â”€ api/                    # Paquete del Backend (Node.js/Express/TypeScript)
    â”‚   â”œâ”€â”€ .env.example
    â”‚   â”œâ”€â”€ package.json        # Dependencias (express), scripts (dev, build, start)
    â”‚   â”œâ”€â”€ src/
    â”‚   â”‚   â”œâ”€â”€ index.ts        # Punto de entrada del servidor
    â”‚   â”‚   â”œâ”€â”€ routes/
    â”‚   â”‚   â””â”€â”€ services/
    â”‚   â””â”€â”€ tsconfig.json       # Extiende tsconfig.base.json
    â”œâ”€â”€ shared-types/           # Paquete compartido (ej: tipos TypeScript)
    â”‚   â”œâ”€â”€ package.json        # MÃ­nimo, define 'main' y 'types'
    â”‚   â”œâ”€â”€ src/
    â”‚   â”‚   â”œâ”€â”€ index.ts        # Exporta todo
    â”‚   â”‚   â””â”€â”€ user.ts
    â”‚   â””â”€â”€ tsconfig.json       # Extiende tsconfig.base.json, config de build .d.ts
    â””â”€â”€ web/                    # Paquete del Frontend (React/Vite/TypeScript)
        â”œâ”€â”€ .env.example
        â”œâ”€â”€ index.html
        â”œâ”€â”€ package.json        # Dependencias (react), scripts (dev, build, preview)
        â”œâ”€â”€ public/
        â”œâ”€â”€ src/                # Similar al ejemplo frontend-react standalone
        â”‚   â”œâ”€â”€ main.tsx
        â”‚   â”œâ”€â”€ App.tsx
        â”‚   â”œâ”€â”€ components/
        â”‚   â”œâ”€â”€ hooks/
        â”‚   â”œâ”€â”€ pages/
        â”‚   â””â”€â”€ services/       # Importa tipos desde 'shared-types'
        â”œâ”€â”€ tsconfig.json       # Extiende tsconfig.base.json
        â””â”€â”€ vite.config.ts
```
